<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>InnoMedia Auto RAG Upload Page</title>
  <link rel="icon" type="image/png" href="logo-layer-80x89.png">
  <style>
    * {
      box-sizing: border-box;
    }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 0;
      background: #f9f9f9;
      color: #333;
      display: flex;
      flex-direction: column;
      height: 100vh;
      overflow: hidden;
    }
    
    /* Header Section */
    .header {
      display: flex;
      align-items: center;
      padding: 1rem;
      background: white;
      border-bottom: 1px solid #ddd;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    #logo {
      width: 50px;
      height: auto;
      object-fit: contain;
      border-radius: 6px;
      margin-right: 1rem;
    }    
    h1 {
      flex-grow: 1;
      text-align: center;
      font-weight: 700;
      font-size: 1.8rem;
      margin: 0;
      color: #2c3e50;
    }
    
    /* Controls Section */
    .controls {
      padding: 1rem;
      background: white;
      border-bottom: 1px solid #ddd;
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
    
    /* Company Selection */
    .company-section {
      display: flex;
      align-items: center;
      gap: 1rem;
    }
    .company-label {
      font-weight: 600;
      font-size: 1rem;
      color: #2c3e50;
      min-width: 80px;
    }
    #companySelect {
      padding: 0.6rem 1rem;
      font-size: 1rem;
      border: 2px solid #ddd;
      border-radius: 8px;
      background: white;
      min-width: 200px;
      transition: border-color 0.3s ease, box-shadow 0.3s ease;
    }
    #companySelect:focus {
      outline: none;
      border-color: #3498db;
      box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
    }
    
    /* Button Toolbar */
    .button-toolbar {
      display: flex;
      gap: 0;
      background: #ecf0f1;
      border-radius: 10px;
      padding: 4px;
      box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
      width: fit-content;
    }
    .toolbar-btn {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.75rem 1.5rem;
      font-size: 1rem;
      font-weight: 600;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.3s ease;
      background: transparent;
      color: #7f8c8d;
    }
    .toolbar-btn:hover:not(:disabled) {
      background: white;
      transform: translateY(-1px);
      box-shadow: 0 2px 8px rgba(0,0,0,0.15);
    }
    .toolbar-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }
    .toolbar-btn.upload {
      color: #2980b9;
    }
    .toolbar-btn.upload:hover:not(:disabled) {
      color: #3498db;
      background: #ebf3fd;
    }
    .toolbar-btn.delete {
      color: #c0392b;
    }
    .toolbar-btn.delete:hover:not(:disabled) {
      color: #e74c3c;
      background: #fdf2f2;
    }
    .toolbar-btn.delete-selected {
      color: #e67e22;
    }
    .toolbar-btn.delete-selected:hover:not(:disabled) {
      color: #f39c12;
      background: #fef9e7;
    }
    
    /* File Window */
    .file-window-container {
      flex: 1;
      display: flex;
      flex-direction: column;
      background: white;
      margin: 1rem;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      overflow: hidden;
      position: relative;
    }
    
    .file-window-header {
      display: flex;
      background: #34495e;
      color: white;
      font-weight: 600;
      font-size: 0.95rem;
      border-bottom: 1px solid #2c3e50;
    }
    .header-cell {
      padding: 1rem;
      border-right: 1px solid #2c3e50;
      display: flex;
      align-items: center;
    }
    .header-cell.select {
      width: 80px;
      justify-content: center;
    }
    .header-cell.filename {
      flex: 1;
    }
    .header-cell.size {
      width: 120px;
      text-align: right;
      justify-content: flex-end;
    }
    .header-cell:last-child {
      border-right: none;
    }
    
    .file-window-content {
      flex: 1;
      overflow-y: auto;
      position: relative;
    }
    
    .file-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    
    .file-item {
      display: flex;
      align-items: center;
      padding: 0.75rem 1rem;
      border-bottom: 1px solid #ecf0f1;
      transition: background-color 0.2s ease;
    }
    .file-item:hover {
      background-color: #f8f9fa;
    }
    .file-item:last-child {
      border-bottom: none;
    }
    
    .file-select {
      width: 80px;
      display: flex;
      justify-content: center;
    }
    
    .file-checkbox {
      width: 18px;
      height: 18px;
      cursor: pointer;
      accent-color: #3498db;
    }
    
    #selectAllCheckbox {
      width: 18px;
      height: 18px;
      cursor: pointer;
      accent-color: #3498db;
    }
    
    .file-icon {
      font-size: 1.3rem;
      margin-right: 0.75rem;
      width: 20px;
      text-align: center;
    }
    
    .file-name {
      flex: 1;
      font-weight: 500;
      word-break: break-word;
    }
    
    .file-size {
      width: 120px;
      text-align: right;
      color: #7f8c8d;
      font-size: 0.9rem;
    }
    
    .no-files {
      display: flex;
      align-items: center;
      justify-content: center;
      height: 200px;
      color: #95a5a6;
      font-style: italic;
      font-size: 1.1rem;
    }
    
    /* Loading Overlay */
    .loading-overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(255, 255, 255, 0.9);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 100;
      backdrop-filter: blur(2px);
      flex-direction: column;
      gap: 1rem;
    }
    .loading-overlay.show {
      display: flex;
    }
    
    .loading-message {
      font-weight: 600;
      color: #2c3e50;
      font-size: 1.1rem;
    }
    
    /* Spinner */
    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }
    .spinner {
      border: 4px solid #ecf0f1;
      border-top: 4px solid #3498db;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
    }
    
    /* Hidden file input */
    #fileInput {
      display: none;
    }
    
    /* Error Modal */
    .error-modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(2px);
    }
    
    .error-modal-content {
      background-color: white;
      margin: 15% auto;
      padding: 0;
      border-radius: 12px;
      width: 90%;
      max-width: 500px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      overflow: hidden;
    }
    
    .error-modal-header {
      background: #e74c3c;
      color: white;
      padding: 1.5rem;
      font-weight: 600;
      font-size: 1.2rem;
    }
    
    .error-modal-body {
      padding: 1.5rem;
      color: #2c3e50;
      line-height: 1.6;
    }
    
    .error-modal-footer {
      padding: 1rem 1.5rem;
      text-align: right;
      background: #f8f9fa;
      border-top: 1px solid #ecf0f1;
    }
    
    .error-ok-btn {
      padding: 0.6rem 1.5rem;
      background: #3498db;
      color: white;
      border: none;
      border-radius: 6px;
      font-weight: 600;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
    .error-ok-btn:hover {
      background: #2980b9;
    }
    
    /* Responsive Design */
    @media (max-width: 768px) {
      h1 {
        font-size: 1.4rem;
      }
      .company-section {
        flex-direction: column;
        align-items: stretch;
        gap: 0.5rem;
      }
      .company-label {
        min-width: auto;
      }
      #companySelect {
        min-width: auto;
      }
      .button-toolbar {
        width: 100%;
        justify-content: center;
        flex-wrap: wrap;
      }
      .toolbar-btn {
        flex: 1;
        justify-content: center;
        min-width: 120px;
      }
      .file-window-container {
        margin: 0.5rem;
      }
      .header-cell, .file-item {
        padding: 0.5rem;
      }
      .header-cell.select, .file-select {
        width: 60px;
      }
      .file-size {
        width: 80px;
        font-size: 0.8rem;
      }
    }
  </style>
</head>
<body>
  <!-- Header -->
  <div class="header">
    <img id="logo" src="logo-layer-80x89.png" alt="Logo" title="Logo" />
    <h1>InnoMedia Auto RAG Upload Page</h1>
  </div>

  <!-- Controls -->
  <div class="controls">
    <!-- Company Selection -->
    <div class="company-section">
      <label class="company-label" for="companySelect">Company:</label>
      <select id="companySelect" name="companySelect">
        <option value="">Choose a Company</option>
        <option value="Company A">Company A</option>
        <option value="Company B">Company B</option>
        <option value="Company C">Company C</option>
      </select>
    </div>

    <!-- Button Toolbar -->
    <div class="button-toolbar">
      <button id="uploadBtn" class="toolbar-btn upload" disabled>
        <span>üì§</span>
        <span>Upload Files</span>
      </button>
      <button id="deleteSelectedBtn" class="toolbar-btn delete-selected" disabled>
        <span>üóÇÔ∏è</span>
        <span>Delete Selected</span>
      </button>
      <button id="deleteBtn" class="toolbar-btn delete" disabled>
        <span>üóëÔ∏è</span>
        <span>Delete All</span>
      </button>
    </div>
  </div>

  <!-- File Window -->
  <div class="file-window-container">
    <div class="file-window-header">
      <div class="header-cell select">
        <input type="checkbox" id="selectAllCheckbox" title="Select All">
      </div>
      <div class="header-cell filename">Filename</div>
      <div class="header-cell size">Size</div>
    </div>
    <div class="file-window-content">
      <div class="no-files">Select a company to view files</div>
      <ul id="fileList" class="file-list" style="display: none;"></ul>
      
      <!-- Loading Overlay -->
      <div id="loadingOverlay" class="loading-overlay">
        <div class="spinner"></div>
        <div class="loading-message" id="loadingMessage">Loading...</div>
      </div>
    </div>
  </div>

  <!-- Hidden file input -->
  <input type="file" id="fileInput" multiple accept="*/*" />

  <!-- Error Modal -->
  <div id="errorModal" class="error-modal">
    <div class="error-modal-content">
      <div class="error-modal-header">
        ‚ö†Ô∏è Error
      </div>
      <div class="error-modal-body" id="errorMessage">
        An error occurred.
      </div>
      <div class="error-modal-footer">
        <button class="error-ok-btn" onclick="closeErrorModal()">OK</button>
      </div>
    </div>
  </div>

  <script>
    // Elements
    const companySelect = document.getElementById('companySelect');
    const uploadBtn = document.getElementById('uploadBtn');
    const deleteBtn = document.getElementById('deleteBtn');
    const deleteSelectedBtn = document.getElementById('deleteSelectedBtn');
    const fileInput = document.getElementById('fileInput');
    const fileList = document.getElementById('fileList');
    const loadingOverlay = document.getElementById('loadingOverlay');
    const loadingMessage = document.getElementById('loadingMessage');
    const errorModal = document.getElementById('errorModal');
    const errorMessage = document.getElementById('errorMessage');
    const noFilesDiv = document.querySelector('.no-files');
    const selectAllCheckbox = document.getElementById('selectAllCheckbox');

    // Google Apps Script URL
    const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbx12yavLEzKttYolF5AaiHCTobTjQ_0XpVNtS3s3vzl9vAEt_ZiG_m9upZey5zqrTMc6g/exec';

    // Track current files for selection management
    let currentFiles = [];

    // Debug logging
    function debugLog(message, data = null) {
      console.log(`[DEBUG] ${message}`, data || '');
      if (data) {
        console.log(`[DEBUG DATA]`, data);
      }
    }

    // Show/hide loading overlay
    function showLoading(message = 'Loading...') {
      loadingMessage.textContent = message;
      loadingOverlay.classList.add('show');
    }

    function hideLoading() {
      loadingOverlay.classList.remove('show');
    }

    // Error modal functions
    function showError(message) {
      errorMessage.textContent = message;
      errorModal.style.display = 'block';
    }

    function closeErrorModal() {
      errorModal.style.display = 'none';
    }

    // Get selected files
    function getSelectedFiles() {
      const checkboxes = document.querySelectorAll('.file-checkbox:checked');
      return Array.from(checkboxes).map(cb => ({
        name: cb.dataset.filename,
        id: cb.dataset.fileid
      }));
    }

    // Update button states based on company selection and file selection
    function updateButtonStates() {
      const hasCompany = companySelect.value !== '';
      const selectedFiles = getSelectedFiles();
      const hasSelectedFiles = selectedFiles.length > 0;
      
      uploadBtn.disabled = !hasCompany;
      deleteBtn.disabled = !hasCompany;
      deleteSelectedBtn.disabled = !hasCompany || !hasSelectedFiles;
    }

    // Update select all checkbox state
    function updateSelectAllState() {
      const checkboxes = document.querySelectorAll('.file-checkbox');
      const checkedBoxes = document.querySelectorAll('.file-checkbox:checked');
      
      if (checkboxes.length === 0) {
        selectAllCheckbox.indeterminate = false;
        selectAllCheckbox.checked = false;
      } else if (checkedBoxes.length === checkboxes.length) {
        selectAllCheckbox.indeterminate = false;
        selectAllCheckbox.checked = true;
      } else if (checkedBoxes.length > 0) {
        selectAllCheckbox.indeterminate = true;
      } else {
        selectAllCheckbox.indeterminate = false;
        selectAllCheckbox.checked = false;
      }
    }

    // Format file size
    function formatFileSize(bytes) {
      if (bytes === 0) return '0 Bytes';
      const k = 1024;
      const sizes = ['Bytes', 'KB', 'MB', 'GB'];
      const i = Math.floor(Math.log(bytes) / Math.log(k));
      return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
    }

    // Get file icon based on extension
    function getFileIcon(fileName) {
      const extension = fileName.split('.').pop().toLowerCase();
      const iconMap = {
        'pdf': 'üìÑ',
        'doc': 'üìù', 'docx': 'üìù',
        'xls': 'üìä', 'xlsx': 'üìä',
        'ppt': 'üìé', 'pptx': 'üìé',
        'txt': 'üìÉ',
        'jpg': 'üñºÔ∏è', 'jpeg': 'üñºÔ∏è', 'png': 'üñºÔ∏è', 'gif': 'üñºÔ∏è',
        'zip': 'üóúÔ∏è', 'rar': 'üóúÔ∏è',
        'mp4': 'üé•', 'avi': 'üé•', 'mov': 'üé•',
        'mp3': 'üéµ', 'wav': 'üéµ',
        'html': 'üåê', 'css': 'üé®', 'js': '‚öôÔ∏è'
      };
      return iconMap[extension] || 'üìÑ';
    }

    // Populate file list
    function populateFileList(files) {
      currentFiles = files || [];
      fileList.innerHTML = '';
      
      if (!files || files.length === 0) {
        fileList.style.display = 'none';
        noFilesDiv.style.display = 'flex';
        noFilesDiv.textContent = 'No Files Found';
        selectAllCheckbox.style.display = 'none';
        updateButtonStates();
        return;
      }

      noFilesDiv.style.display = 'none';
      fileList.style.display = 'block';
      selectAllCheckbox.style.display = 'block';

      files.forEach(file => {
        const listItem = document.createElement('li');
        listItem.className = 'file-item';
        
        const icon = getFileIcon(file.name);
        const size = file.size ? formatFileSize(parseInt(file.size)) : 'Unknown';
        
        listItem.innerHTML = `
          <div class="file-select">
            <input type="checkbox" class="file-checkbox" data-filename="${file.name}" data-fileid="${file.id}">
          </div>
          <span class="file-icon">${icon}</span>
          <span class="file-name">${file.name}</span>
          <span class="file-size">${size}</span>
        `;
        
        fileList.appendChild(listItem);
      });

      // Add event listeners to checkboxes
      document.querySelectorAll('.file-checkbox').forEach(checkbox => {
        checkbox.addEventListener('change', () => {
          updateSelectAllState();
          updateButtonStates();
        });
      });

      updateSelectAllState();
      updateButtonStates();
    }

    // Load files for selected company
    async function loadFiles() {
      if (!companySelect.value) {
        populateFileList([]);
        noFilesDiv.style.display = 'flex';
        noFilesDiv.textContent = 'Select a company to view files';
        selectAllCheckbox.style.display = 'none';
        return;
      }

      showLoading('Loading files...');
      
      try {
        debugLog('Loading files for company:', companySelect.value);
        
        const formData = new FormData();
        formData.append('company', companySelect.value);
        formData.append('operation', 'List Files');
        
        const response = await fetch(GOOGLE_SCRIPT_URL, {
          method: 'POST',
          body: formData
        });

        const responseText = await response.text();
        debugLog('Response text:', responseText);

        if (!response.ok) {
          throw new Error(`Failed to load files: ${responseText}`);
        }

        const responseJson = JSON.parse(responseText);
        debugLog('Parsed response:', responseJson);

        if (responseJson.success) {
          populateFileList(responseJson.files);
        } else {
          throw new Error(responseJson.error || 'Failed to load files');
        }

      } catch (err) {
        debugLog('Error loading files:', err.message);
        showError(`Failed to load files: ${err.message}`);
        populateFileList([]);
      } finally {
        hideLoading();
      }
    }

    // Upload files
    async function uploadFiles(files) {
      showLoading('Uploading files...');
      
      try {
        debugLog('Starting file upload:', files.length + ' files');
        
        for (let i = 0; i < files.length; i++) {
          const file = files[i];
          debugLog(`Uploading file ${i + 1}/${files.length}:`, file.name);
          
          showLoading(`Uploading ${i + 1} of ${files.length} files...`);
          
          const base64Data = await fileToBase64(file);
          
          const formData = new FormData();
          formData.append('company', companySelect.value);
          formData.append('operation', 'Upload Files');
          formData.append('fileName', file.name);
          formData.append('fileData', base64Data);
          formData.append('mimeType', file.type);
          formData.append('fileSize', file.size.toString());
          
          const response = await fetch(GOOGLE_SCRIPT_URL, {
            method: 'POST',
            body: formData
          });
          
          const responseText = await response.text();
          
          if (!response.ok) {
            throw new Error(`Upload failed for ${file.name}: ${responseText}`);
          }
        }
        
        debugLog('All files uploaded successfully');
        
        // Refresh file list
        await loadFiles();
        
      } catch (err) {
        debugLog('Upload error:', err.message);
        showError(`Upload failed: ${err.message}`);
        await loadFiles();
      }
    }

    // Delete selected files
    async function deleteSelectedFiles() {
      const selectedFiles = getSelectedFiles();
      
      if (selectedFiles.length === 0) {
        showError('No files selected for deletion.');
        return;
      }

      const fileNames = selectedFiles.map(f => f.name).join(', ');
      if (!confirm(`Are you sure you want to delete the following ${selectedFiles.length} file(s)?\n\n${fileNames}\n\nThis action cannot be undone.`)) {
        return;
      }

      showLoading('Deleting selected files...');
      
      try {
        debugLog('Starting selective delete operation for files:', selectedFiles);
        
        const formData = new FormData();
        formData.append('company', companySelect.value);
        formData.append('operation', 'Delete Selected');
        formData.append('selectedFiles', JSON.stringify(selectedFiles));
        
        const response = await fetch(GOOGLE_SCRIPT_URL, {
          method: 'POST',
          body: formData
        });

        const responseText = await response.text();
        debugLog('Delete selected response:', responseText);

        if (!response.ok) {
          throw new Error(`Delete operation failed: ${responseText}`);
        }

        const responseJson = JSON.parse(responseText);
        
        if (!responseJson.success) {
          throw new Error(responseJson.error || 'Delete operation failed');
        }
        
        debugLog('Delete selected completed successfully');
        
        // Refresh file list to show current state
        await loadFiles();
        
      } catch (err) {
        debugLog('Delete selected error:', err.message);
        showError(`Delete operation failed: ${err.message}`);
        await loadFiles();
      } finally {
        hideLoading();
      }
    }

    // Delete all files
    async function deleteAllFiles() {
      if (!confirm('Are you sure you want to delete all files? This action cannot be undone.')) {
        return;
      }

      showLoading('Deleting all files...');
      
      try {
        debugLog('Starting delete all operation');
        
        const formData = new FormData();
        formData.append('company', companySelect.value);
        formData.append('operation', 'Delete All');
        
        const response = await fetch(GOOGLE_SCRIPT_URL, {
          method: 'POST',
          body: formData
        });

        const responseText = await response.text();
        debugLog('Delete response:', responseText);

        if (!response.ok) {
          throw new Error(`Delete operation failed: ${responseText}`);
        }

        const responseJson = JSON.parse(responseText);
        
        if (!responseJson.success) {
          throw new Error(responseJson.error || 'Delete operation failed');
        }
        
        debugLog('Delete all completed successfully');
        
        // Show empty state
        populateFileList([]);
        
      } catch (err) {
        debugLog('Delete error:', err.message);
        showError(`Delete operation failed: ${err.message}`);
        await loadFiles();
      } finally {
        hideLoading();
      }
    }

    // Helper function to convert file to base64
    function fileToBase64(file) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.readAsDataURL(file);
        reader.onload = () => {
          const base64 = reader.result.split(',')[1];
          resolve(base64);
        };
        reader.onerror = error => reject(error);
      });
    }

    // File validation functions
    function validateFileSize(file) {
      const maxSizeBytes = 5 * 1024 * 1024; // 5MB in bytes
      if (file.size > maxSizeBytes) {
        return {
          valid: false,
          error: `${file.name}: Uploaded files must be less than 5MB in size`
        };
      }
      return { valid: true };
    }

    function validateFileType(file) {
      const fileName = file.name.toLowerCase();
      const fileExtension = fileName.split('.').pop();
      
      // Image extensions to block
      const imageExtensions = ['jpg', 'jpeg', 'png', 'gif', 'bmp', 'webp', 'svg', 'ico', 'tiff', 'tif'];
      
      // Other blocked extensions
      const blockedExtensions = ['md', 'zip', 'rar', '7z', 'tar', 'gz'];
      
      const allBlockedExtensions = [...imageExtensions, ...blockedExtensions];
      
      if (allBlockedExtensions.includes(fileExtension)) {
        return {
          valid: false,
          error: `${file.name}: Unsupported file type`
        };
      }
      return { valid: true };
    }

    function validateFiles(files) {
      const validFiles = [];
      const errors = [];
      
      for (const file of files) {
        // Check file size
        const sizeValidation = validateFileSize(file);
        if (!sizeValidation.valid) {
          errors.push(sizeValidation.error);
          continue;
        }
        
        // Check file type
        const typeValidation = validateFileType(file);
        if (!typeValidation.valid) {
          errors.push(typeValidation.error);
          continue;
        }
        
        validFiles.push(file);
      }
      
      return { validFiles, errors };
    }

    // Event Listeners
    companySelect.addEventListener('change', () => {
      updateButtonStates();
      loadFiles();
    });

    uploadBtn.addEventListener('click', () => {
      fileInput.click();
    });

    fileInput.addEventListener('change', (e) => {
      if (e.target.files.length > 0) {
        if (e.target.files.length > 10) {
          showError('Maximum 10 files allowed per upload.');
          e.target.value = '';
          return;
        }
        
        // Validate files before upload
        const { validFiles, errors } = validateFiles(Array.from(e.target.files));
        
        // Show errors if any files are invalid
        if (errors.length > 0) {
          showError(errors.join('\n'));
        }
        
        // Only upload valid files
        if (validFiles.length > 0) {
          uploadFiles(validFiles);
        }
        
        // Clear the input so the same files can be selected again if needed
        e.target.value = '';
      }
    });

    deleteSelectedBtn.addEventListener('click', deleteSelectedFiles);

    deleteBtn.addEventListener('click', deleteAllFiles);

    // Select all checkbox functionality
    selectAllCheckbox.addEventListener('change', (e) => {
      const checkboxes = document.querySelectorAll('.file-checkbox');
      checkboxes.forEach(checkbox => {
        checkbox.checked = e.target.checked;
      });
      updateButtonStates();
    });

    // Close error modal when clicking outside
    errorModal.addEventListener('click', (e) => {
      if (e.target === errorModal) {
        closeErrorModal();
      }
    });

    // Initialize
    updateButtonStates();
  </script>
</body>
</html>